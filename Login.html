<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Login</title>
        <link rel="stylesheet" href="./FONT/fontawesome-free-5.15.4-web/css/all.min.css">
        <link rel="stylesheet" href="./UTIL/bootstrap-4.6.1-dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="./CSS/base.min.css">
        <link rel="stylesheet" href="./CSS/header.min.css">
        <link rel="stylesheet" href="./CSS/resp_header.min.css">
        <link rel="stylesheet" href="./CSS/footer.min.css">
        <link rel="stylesheet" href="./CSS/resp_footer.min.css">
        <link rel="stylesheet" href="./CSS/style.min.css">
        <link rel="stylesheet" href="./CSS/login.min.css">
        <link rel="stylesheet" href="./CSS/resp_login.min.css">
    </head>
    <body>
        <main class="app">
            <header></header>

            <section>
                <div class="container">
                    <div class="row no-gutters">
                        <div class="form">
                            <h3>Login to your account</h3>
                            <form action="" id="login">
                                <div class="form-group login-msg">
                                    <div class="row no-gutters">
                                        <div class="form-group__item col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                            <div class="form-messenger">Test</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row no-gutters">
                                        <div class="form-group__item form-group__item--label col col-xl-3 col-lg-3 col-md-3 col-sm-12 col-12">
                                            <label for="">Email</label>
                                        </div>
                                        <div class="form-group__item form-group__item--input col col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <input type="email" name="email" rule="required|email">
                                        </div>
                                        <div class="form-group__item form-group__item--msg col col-xl-3 col-lg-3 col-md-3 col-sm-12 col-12">
                                        </div>
                                        <div class="col col-xl-3 col-lg-3 col-md-3 hidden-small"></div>
                                        <div class="form-group__item col col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="form-messenger"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row no-gutters">
                                        <div class="form-group__item form-group__item--label col col-xl-3 col-lg-3 col-md-3 col-sm-12 col-12">
                                            <label for="">Password</label>
                                        </div>
                                        <div class="form-group__item form-group__item--input form-group__item--text--right col col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <input name="password" type="password" rule="required">
                                            <span class="form-group__item__text">Show</span>
                                        </div>
                                        <div class="form-group__item form-group__item--msg col col-xl-3 col-lg-3 col-md-3 col-sm-12 col-12">
                                        </div>
                                        <div class="col col-xl-3 col-lg-3 col-md-3 hidden-small"></div>
                                        <div class="form-group__item col col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="form-messenger"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row no-gutters">
                                        <div class="col col-xl-3 col-lg-3 col-md-3 col-sm-12 col-12"></div>
                                        <div class="form-group__item col col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <a class="form-group__link hover-text" href="./forgotPassword.html">Forgot your password?</a>
                                        </div>
                                    </div>
                                </div>
                                <button class="submit">Sign in</button>
                                <div class="form__footer">
                                    <h3>Connect with Social Networks</h3>
                                    <div class="social d-flex justify-content-center">
                                        <div class="social-item social-item--facebook">
                                            <span class="social-item__icon social-item__icon--facebook">
                                                <i class="fab fa-facebook-f"></i>
                                            </span>
                                            <span class="social-item__text">Facebook</span>
                                        </div>
                                        <div class="social-item social-item--google">
                                            <span class="social-item__icon social-item__icon--google">
                                                <i class="fab fa-google"></i>
                                            </span>
                                            <span class="social-item__text">Google</span>
                                        </div>
                                        <div class="social-item social-item--twitter">
                                            <span class="social-item__icon social-item__icon--twitter">
                                                <i class="fab fa-twitter"></i>
                                            </span>
                                            <span class="social-item__text">Twitter</span>
                                        </div>
                                    </div>
                                </div>
                                <a href="./Register.html" class="form__footer__link hover-text">No account? Create one here</a>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
            
            <footer></footer>
            
            <div class="back-to-top">
                <i class="fas fa-chevron-up"></i>
            </div>

            <div class="modal__overlay"></div>
        </main>

        <script src="./JS/Header.min.js"></script>
        <script src="./JS/Footer.min.js"></script>
        <script src="./UTIL/jQuery/jQuery.js"></script>
        <script src="./UTIL/bootstrap-4.6.1-dist/js/bootstrap.min.js"></script>
        <script src="./JS/main.min.js"></script>
        <script src="./JS/Validator.min.js"></script>
        <script src="./JS/AuthenticatorForm.min.js"></script>
        <script>
            const loginForm = new Validator('#login');
            const msgLogin = document.querySelector('#login .login-msg');

            if (!document.referrer.includes('Login') && !document.referrer.includes('Register') && !document.referrer.includes('forgotPassword.html')) {
                localStorage.setItem('prevHref', document.referrer);
            }

            loginForm.onSubmit = data => {
                const userList = JSON.parse(localStorage.getItem('user-ttthh-key'))
                    ?? []; 
                const getUser = userList.find(user => user.email === data.email 
                    && user.password === data.password);

                if (getUser) {
                    localStorage.setItem('user-ttthh-info', JSON.stringify(getUser))
                    var url_string = window.location.href;
                    var url = new URL(url_string);
                    var href = url.searchParams.get("href");
                    if (href) {
                        window.location = `/${href}.html`;
                    } else {
                        const prevHref = localStorage.getItem('prevHref');
                        localStorage.removeItem('prevHref');
                        if (prevHref)
                            window.location = prevHref;
                        else
                            window.location = `/index.html`;
                    }
                } else {
                    msgLogin.classList.add('invalid');
                    msgLogin.querySelector('.form-messenger').innerHTML = 
                        '<span><i class="fas fa-times"></i></span>Email hoặc mật khẩu không đúng.';  
                } 
            };
        </script>
    </body>
</html>
